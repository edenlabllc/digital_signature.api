FROM elixir:1.6

RUN apt-get update && apt-get -yqq install \
    postgresql-9.6 \
    postgresql-client-9.6

USER postgres
RUN service postgresql start && psql -c "ALTER USER postgres PASSWORD 'postgres';"

USER root
ADD . /home/digital_signature.api
WORKDIR /home/digital_signature.api

ENV TZ=Europe/Kiev
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

ENV MIX_ENV=test

RUN mix do \
    local.hex --force, \
    local.rebar --force, \
    deps.get, \
    deps.compile
